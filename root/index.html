<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>FreeBSD Online Document Editor</title>
   <script>
      // Display confirmation message when closing the page
      window.addEventListener('beforeunload', function(e) {
         // Custom message to inform the user
         var confirmationMessage = 'Your content may not be stored. Are you sure you want to leave this page?';
         
         // Some browsers require the confirmation message to be set
         e.returnValue = confirmationMessage;
         
         return confirmationMessage;
      });
   </script>
   <script>
      let isDragging = false;
      let containerRect, dragLine, leftDiv, rightDiv;

      function startDrag(event) {
         isDragging = true;
         containerRect = document.querySelector('.editor-container').getBoundingClientRect();
         dragLine = document.getElementById('dragLine');
         leftDiv = document.getElementById('left');
         rightDiv = document.getElementById('right');
      }

      document.addEventListener('mousemove', throttle(drag));
      document.addEventListener('mouseup', stopDrag);

      function drag(event) {
         if (isDragging) {
            console.log('Nice');
            const dragX = event.clientX - containerRect.left;

            if (dragX >= 0 && dragX <= containerRect.width) {
               leftDiv.style.width = (dragX / containerRect.width) * 100 + '%';
               rightDiv.style.width = 100 - (dragX / containerRect.width) * 100 + '%';
               dragLine.style.left = (dragX - dragLine.clientWidth / 2) + 'px';
            }
         }
      }

      function stopDrag() {
         isDragging = false;
         var editor = ace.edit("editor")
         editor.resize();
      }

      // Throttle function to reduce the frequency of event handling
      function throttle(callback) {
         let ticking = false;

         return function (event) {
            if (!ticking) {
               ticking = true;
               requestAnimationFrame(() => {
               callback(event);
               ticking = false;
               });
            }
         };
      }
   </script>

   <link rel="stylesheet" href="styles/reset.css">
   <link rel="stylesheet" href="styles/index.css">
</head>
<body>
   <div class="title-container">
      <h1 class="title">FreeBSD Online Document Editor</h1>

      <a title="Change file" class="change_adoc" href="javascript:null"> 
         <img src="./img/exchange_2.png">
      </a>
      <a title="Generate HTML" href="javascript:null" onclick="generate_html()"> 
         <img src="./img/html_2.png">
      </a>
      <a title="Save Content" href="javascript:null" onclick="store_content()"> 
         <img src="./img/save_2.ico">
      </a>
      <a title="Download patch" href="javascript:null" onclick="patch_download()">
         <img src="./img/download_2.png" >
      </a>
      <a title="FreeBSD Bugzilla" href="javascript:null" onclick="window.open('https://bugs.freebsd.org/bugzilla/','_blank')"> 
         <img src="./img/web_2.png">
      </a>
      <a title="Help" href="pages/help.html" target="_blank"> 
         <img src="./img/help_2.png">
      </a>
   </div>

   <div class="file-title-container">
      <h1 class="file-title"></h1>
   </div>

    <div class="editor-container">
      <div id="left" class="left">
        <div id="editor"></div>
      </div>
      <div id="dragLine" onmousedown="startDrag(event)" onmousemove="drag(event)"></div>
      <div id="right" class="right">
        <iframe id="output" "></iframe>
      </div>
    </div>
    

   <div class="footer">
      <p>Made with â™¥ by the FreeBSD Community</p>
   </div>

   <!-- include asciidoctor by js core file -->
   <!-- <script src="scripts/asciidoctor.js"></script> -->
   <script src="node_modules/@asciidoctor/core/dist/browser/asciidoctor.js"></script>
   <!-- include ace.js by CDN -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.11.2/ace.js" integrity="sha512-AhCq6G80Ge/e6Pl3QTNGI2Je+6ixVVDmmE4Nui8/dHRBKxMUvjJxn6CYEcMQdTSxHreC3USOxTDrvUPLtN5J7w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
   <!-- include diff.js by CDN -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.1.0/diff.min.js" integrity="sha512-vco9RAxEuv4PQ+iTQyuKElwoUOcsVdp+WgU6Lgo82ASpDfF7vI66LlWz+CZc2lMdn52tjjLOuHvy8BQJFp8a1A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 

   <!-- our js file -->
   <script src="scripts/index.js"></script>
   <script src="scripts/patch_download.js"></script>

   <!-- asciidcor syntax extension from freebsd doc project (translated by opal-compiler) -->
   <script type="text/javascript" src="lib/cross-document-references-macro.js"></script>
   <script type="text/javascript" src="lib/inter-document-references-macro.js"></script>
   <script type="text/javascript" src="lib/git-macro.js"></script>
   <script type="text/javascript" src="lib/man-macro.js"></script>
   <script type="text/javascript" src="lib/packages-macro.js"></script>
   <script type="text/javascript" src="lib/sectnumoffset-treeprocessor.js"></script>
</body>
</html>